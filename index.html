<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gráficos com Motivos Separados</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 0;
            padding: 20px;
            background-color: #121212;
            color: #ffffff;
        }
        .chart-container {
            width: 800px;
            margin: 20px 0;
        }
        canvas {
            background-color: #1e1e1e;
            border: 1px solid #333;
            border-radius: 8px;
        }
        button {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            font-size: 16px;
        }
        button:hover {
            background-color: #ff6666;
        }
        .total-display {
            font-size: 18px;
            margin-bottom: 10px;
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Gráficos com Dados e Motivos Separados</h1>

    <!-- Primeiro Gráfico -->
    <div class="chart-container">
        <div id="totalChart1" class="total-display"></div>
        <canvas id="chart1"></canvas>
        <button id="clearButton1">Limpar Dados do Gráfico 1</button>
    </div>

    <!-- Segundo Gráfico -->
    <div class="chart-container">
        <div id="totalChart2" class="total-display"></div>
        <canvas id="chart2"></canvas>
        <button id="clearButton2">Limpar Dados do Gráfico 2</button>
    </div>

    <script>
        const days = Array.from({ length: 32 }, (_, i) => i);

        // Função para criar e configurar o Gráfico 1
        function createChart1() {
            const ctx1 = document.getElementById('chart1').getContext('2d');
            const storedValues1 = JSON.parse(localStorage.getItem('chart1Values')) || Array(32).fill(null);
            const storedMotivos1 = JSON.parse(localStorage.getItem('chart1Motivos')) || Array(32).fill(null);
            const values1 = [...storedValues1];
            const motivos1 = [...storedMotivos1];

            const updateTotal1 = () => {
                const total = values1.reduce((acc, val) => (val !== null ? acc + val : acc), 0);
                document.getElementById('totalChart1').textContent = `Valor Acumulado: R$ ${total.toFixed(2)}`;
            };

            Chart.register({
                id: 'chart1DataLabelsPlugin',
                afterDatasetsDraw(chart) {
                    const { ctx } = chart;
                    chart.data.datasets.forEach((dataset, datasetIndex) => {
                        const meta = chart.getDatasetMeta(datasetIndex);
                        meta.data.forEach((point, index) => {
                            const value = dataset.data[index];
                            const motivo = motivos1[index];
                            if (value !== null && datasetIndex === 0) {
                                ctx.save();
                                ctx.font = '12px Arial';
                                ctx.fillStyle = '#ffffff';
                                ctx.textAlign = 'center';
                                const offsetY = motivo ? -20 : -10;
                                ctx.fillText(`R$ ${value}`, point.x, point.y + offsetY);
                                if (motivo) {
                                    ctx.font = '10px Arial';
                                    ctx.fillStyle = '#ffcc00';
                                    ctx.fillText(motivo, point.x, point.y + 5);
                                }
                                ctx.restore();
                            }
                        });
                    });
                }
            });

            const chart1 = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [
                        {
                            label: 'Valores Digitados',
                            data: values1,
                            borderColor: 'cyan',
                            borderWidth: 2,
                            fill: false,
                            pointBackgroundColor: 'magenta',
                            pointRadius: 5,
                        },
                        {
                            label: 'Média dos Valores',
                            data: Array(32).fill(null),
                            borderColor: 'lime',
                            borderWidth: 2,
                            fill: false,
                            pointRadius: 0,
                            tension: 0.4,
                        },
                        {
                            label: 'Valor 100',
                            data: Array(32).fill(100),
                            borderColor: 'orange',
                            borderWidth: 8,
                            fill: false,
                            pointRadius: 0,
                        }
                    ],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white',
                            },
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const value = context.raw || 0;
                                    const day = context.dataIndex;
                                    const motivo = motivos1[day] ? `Motivo: ${motivos1[day]}` : '';
                                    return [`R$ ${value}`, motivo];
                                },
                            },
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Valor (R$)',
                                color: 'white',
                            },
                            ticks: {
                                callback: (value) => `R$ ${value}`,
                                color: 'white',
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Dias',
                                color: 'white',
                            },
                            ticks: {
                                color: 'white',
                            },
                        },
                    },
                    onClick: (e) => handleAxisClick1(e),
                },
            });

            function handleAxisClick1(event) {
                const xAxis = chart1.scales.x;
                const xPosition = event.x;
                const closestDay = xAxis.getValueForPixel(xPosition);
                const roundedDay = Math.round(closestDay);
                if (roundedDay >= 0 && roundedDay <= 31) {
                    const newValue = prompt(`Digite o valor em R$ para o dia ${roundedDay}:`);
                    if (newValue !== null && !isNaN(newValue)) {
                        values1[roundedDay] = parseFloat(newValue);
                        const motivo = prompt(`Digite o motivo para o valor no dia ${roundedDay}:`);
                        motivos1[roundedDay] = motivo;
                        updateChart1();
                    }
                }
            }

            function calculateAverage1(data) {
                const validValues = data.filter((v) => v !== null);
                if (validValues.length === 0) return null;
                return validValues.reduce((a, b) => a + b, 0) / validValues.length;
            }

            function updateChart1() {
                const average = calculateAverage1(values1);
                chart1.data.datasets[0].data = values1;
                chart1.data.datasets[1].data = Array(32).fill(average);
                localStorage.setItem('chart1Values', JSON.stringify(values1));
                localStorage.setItem('chart1Motivos', JSON.stringify(motivos1));
                updateTotal1();
                chart1.update();
            }

            document.getElementById('clearButton1').addEventListener('click', () => {
                localStorage.removeItem('chart1Values');
                localStorage.removeItem('chart1Motivos');
                values1.fill(null);
                motivos1.fill(null);
                updateChart1();
            });

            updateChart1();
        }

        // Função para criar e configurar o Gráfico 2
        function createChart2() {
            const ctx2 = document.getElementById('chart2').getContext('2d');
            const storedValues2 = JSON.parse(localStorage.getItem('chart2Values')) || Array(32).fill(null);
            const storedMotivos2 = JSON.parse(localStorage.getItem('chart2Motivos')) || Array(32).fill(null);
            const values2 = [...storedValues2];
            const motivos2 = [...storedMotivos2];

            const updateTotal2 = () => {
                const total = values2.reduce((acc, val) => (val !== null ? acc + val : acc), 0);
                document.getElementById('totalChart2').textContent = `Valor Acumulado: R$ ${total.toFixed(2)}`;
            };

            Chart.register({
                id: 'chart2DataLabelsPlugin',
                afterDatasetsDraw(chart) {
                    const { ctx } = chart;
                    chart.data.datasets.forEach((dataset, datasetIndex) => {
                        const meta = chart.getDatasetMeta(datasetIndex);
                        meta.data.forEach((point, index) => {
                            const value = dataset.data[index];
                            const motivo = motivos2[index];
                            if (value !== null && datasetIndex === 0) {
                                ctx.save();
                                ctx.font = '12px Arial';
                                ctx.fillStyle = '#ffffff';
                                ctx.textAlign = 'center';
                                const offsetY = motivo ? -20 : -10;
                                ctx.fillText(`R$ ${value}`, point.x, point.y + offsetY);
                                if (motivo) {
                                    ctx.font = '10px Arial';
                                    ctx.fillStyle = '#ffcc00';
                                    ctx.fillText(motivo, point.x, point.y + 5);
                                }
                                ctx.restore();
                            }
                        });
                    });
                }
            });

            const chart2 = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: days,
                    datasets: [
                        {
                            label: 'Valores Digitados',
                            data: values2,
                            borderColor: 'cyan',
                            borderWidth: 2,
                            fill: false,
                            pointBackgroundColor: 'magenta',
                            pointRadius: 5,
                        },
                        {
                            label: 'Média dos Valores',
                            data: Array(32).fill(null),
                            borderColor: 'lime',
                            borderWidth: 2,
                            fill: false,
                            pointRadius: 0,
                            tension: 0.4,
                        },
                        {
                            label: 'Valor 100',
                            data: Array(32).fill(100),
                            borderColor: 'orange',
                            borderWidth: 8,
                            fill: false,
                            pointRadius: 0,
                        }
                    ],
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            labels: {
                                color: 'white',
                            },
                        },
                        tooltip: {
                            callbacks: {
                                label: (context) => {
                                    const value = context.raw || 0;
                                    const day = context.dataIndex;
                                    const motivo = motivos2[day] ? `Motivo: ${motivos2[day]}` : '';
                                    return [`R$ ${value}`, motivo];
                                },
                            },
                        },
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Valor (R$)',
                                color: 'white',
                            },
                            ticks: {
                                callback: (value) => `R$ ${value}`,
                                color: 'white',
                            },
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Dias',
                                color: 'white',
                            },
                            ticks: {
                                color: 'white',
                            },
                        },
                    },
                    onClick: (e) => handleAxisClick2(e),
                },
            });

            function handleAxisClick2(event) {
                const xAxis = chart2.scales.x;
                const xPosition = event.x;
                const closestDay = xAxis.getValueForPixel(xPosition);
                const roundedDay = Math.round(closestDay);
                if (roundedDay >= 0 && roundedDay <= 31) {
                    const newValue = prompt(`Digite o valor em R$ para o dia ${roundedDay}:`);
                    if (newValue !== null && !isNaN(newValue)) {
                        values2[roundedDay] = parseFloat(newValue);
                        const motivo = prompt(`Digite o motivo para o valor no dia ${roundedDay}:`);
                        motivos2[roundedDay] = motivo;
                        updateChart2();
                    }
                }
            }

            function calculateAverage2(data) {
                const validValues = data.filter((v) => v !== null);
                if (validValues.length === 0) return null;
                return validValues.reduce((a, b) => a + b, 0) / validValues.length;
            }

            function updateChart2() {
                const average = calculateAverage2(values2);
                chart2.data.datasets[0].data = values2;
                chart2.data.datasets[1].data = Array(32).fill(average);
                localStorage.setItem('chart2Values', JSON.stringify(values2));
                localStorage.setItem('chart2Motivos', JSON.stringify(motivos2));
                updateTotal2();
                chart2.update();
            }

            document.getElementById('clearButton2').addEventListener('click', () => {
                localStorage.removeItem('chart2Values');
                localStorage.removeItem('chart2Motivos');
                values2.fill(null);
                motivos2.fill(null);
                updateChart2();
            });

            updateChart2();
        }

        createChart1();
        createChart2();
    </script>
</body>
</html>
